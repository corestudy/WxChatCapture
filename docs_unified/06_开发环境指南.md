# 🛠️ 开发环境指南 v3.0.6

## 🎯 概述

本指南为智能滚动截图工具的开发者提供完整的开发环境设置、代码规范、测试指南和贡献流程。无论您是初次参与开源项目的新手，还是经验丰富的开发者，本指南都将帮助您快速上手项目开发。

### 🌟 开发特色
- **模块化架构**: 清晰的代码结构，易于理解和扩展
- **完善测试**: 全面的测试覆盖，确保代码质量
- **标准规范**: 遵循Python最佳实践和PEP规范
- **持续集成**: 自动化测试和部署流程

## 🚀 快速开始

### 环境要求
- **Python**: 3.7+
- **操作系统**: Windows 10/11
- **内存**: 4GB+
- **存储**: 1GB+

### 开发环境设置

#### 1. 克隆项目
```bash
git clone <repository-url>
cd smart-screenshot-tool/tk
```

#### 2. 创建虚拟环境
```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

#### 3. 安装依赖
```bash
# 安装基础依赖
pip install -r requirements.txt

# 安装开发依赖
pip install -e ".[dev]"
```

#### 4. 验证安装
```bash
# 运行主程序
python src/main.py

# 运行测试
python -m pytest tests/
```

## 🏗️ 项目架构

### 目录结构
```
tk/
├── src/                    # 源代码
│   ├── main.py            # 主程序入口
│   ├── config.py          # 配置管理
│   ├── utils.py           # 工具函数
│   ├── evidence_recorder.py # 证据记录
│   ├── legal_compliance.py # 法律合规
│   └── wechat_detector.py # 微信检测
├── tests/                 # 测试文件
│   ├── test_ui.py         # UI测试
│   └── test_performance.py # 性能测试
├── docs/                  # 原始文档
└── docs_unified/          # 统一文档
```

### 核心模块

#### main.py - 主程序
- **ScrollController**: 滚动控制器
- **ScrollScreenshotApp**: 主应用类
- **UI组件**: 现代化界面实现

#### evidence_recorder.py - 证据记录
- **EvidenceRecorder**: 证据链记录
- **ScreenRecorder**: 屏幕录制
- **系统信息收集**: 环境信息记录

## 🔧 开发工具

### 代码编辑器推荐
- **VS Code**: 推荐插件
  - Python
  - Pylint
  - Black Formatter
  - GitLens

### 调试工具
```bash
# 调试模式运行
python src/main.py --debug

# 性能分析
python -m cProfile src/main.py

# 内存分析
python -m memory_profiler src/main.py
```

## 📋 代码规范

### Python代码风格
- 遵循 PEP 8 标准
- 使用 Black 进行代码格式化
- 使用 Pylint 进行代码检查

### 命名规范
```python
# 类名：大驼峰
class ScrollController:
    pass

# 函数名：小写+下划线
def capture_screenshot():
    pass

# 常量：大写+下划线
MAX_RETRY_COUNT = 3

# 私有方法：前缀下划线
def _internal_method():
    pass
```

### 文档字符串
```python
def capture_region(self, region, mode="auto"):
    """
    捕获指定区域的截图
    
    Args:
        region (tuple): 区域坐标 (x, y, width, height)
        mode (str): 捕获模式 ("auto", "manual")
    
    Returns:
        PIL.Image: 截图图像对象
        
    Raises:
        ScreenshotError: 截图失败时抛出
    """
    pass
```

## 🧪 测试指南

### 测试结构
```
tests/
├── test_ui.py              # UI功能测试
├── test_performance.py     # 性能测试
├── test_evidence.py        # 证据功能测试
└── fixtures/               # 测试数据
```

### 运行测试
```bash
# 运行所有测试
python -m pytest

# 运行特定测试
python -m pytest tests/test_ui.py

# 生成覆盖率报告
python -m pytest --cov=src tests/
```

### 测试编写示例
```python
import unittest
from src.main import ScrollScreenshotApp

class TestScrollScreenshotApp(unittest.TestCase):
    def setUp(self):
        """测试前准备"""
        self.app = ScrollScreenshotApp(None)
    
    def test_region_selection(self):
        """测试区域选择功能"""
        region = (100, 100, 500, 400)
        self.app.set_region(region)
        self.assertEqual(self.app.region, region)
    
    def tearDown(self):
        """测试后清理"""
        if hasattr(self.app, 'cleanup'):
            self.app.cleanup()
```

## 🔄 Git工作流

### 分支策略
- **main**: 主分支，稳定版本
- **develop**: 开发分支，集成新功能
- **feature/***: 功能分支
- **hotfix/***: 紧急修复分支

### 提交规范
```bash
# 功能提交
git commit -m "feat: 添加录屏功能"

# 修复提交
git commit -m "fix: 修复截图区域选择问题"

# 文档提交
git commit -m "docs: 更新API文档"

# 重构提交
git commit -m "refactor: 优化滚动控制逻辑"
```

### Pull Request流程
1. 创建功能分支
2. 开发和测试
3. 提交Pull Request
4. 代码审查
5. 合并到develop分支

## 🚀 构建和发布

### 本地构建
```bash
# 构建包
python setup.py sdist bdist_wheel

# 安装本地包
pip install dist/smart-screenshot-tool-3.0.6.tar.gz
```

### 版本管理
```bash
# 更新版本号
# 修改 setup.py 中的 version
# 更新 CHANGELOG.md

# 创建标签
git tag v3.0.6
git push origin v3.0.6
```

## 🐛 调试技巧

### 常用调试方法
```python
# 添加调试日志
import logging
logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

# 使用断点调试
import pdb; pdb.set_trace()

# 性能分析
import time
start_time = time.time()
# ... 代码 ...
print(f"执行时间: {time.time() - start_time:.2f}秒")
```

### 常见问题排查
1. **导入错误**: 检查PYTHONPATH和虚拟环境
2. **权限问题**: 以管理员身份运行
3. **依赖冲突**: 使用虚拟环境隔离
4. **性能问题**: 使用profiler分析

## 📚 学习资源

### 推荐阅读
- [Python官方文档](https://docs.python.org/)
- [Tkinter教程](https://docs.python.org/3/library/tkinter.html)
- [PIL/Pillow文档](https://pillow.readthedocs.io/)
- [OpenCV Python教程](https://opencv-python-tutroals.readthedocs.io/)

### 相关项目
- [pyautogui](https://github.com/asweigart/pyautogui)
- [pywinauto](https://github.com/pywinauto/pywinauto)
- [keyboard](https://github.com/boppreh/keyboard)

## 🤝 贡献指南

### 如何贡献
1. Fork项目
2. 创建功能分支
3. 编写代码和测试
4. 提交Pull Request
5. 参与代码审查

### 贡献类型
- **功能开发**: 新功能实现
- **Bug修复**: 问题修复
- **文档改进**: 文档完善
- **性能优化**: 性能提升
- **测试增强**: 测试覆盖

### 代码审查标准
- 代码质量和规范
- 测试覆盖率
- 文档完整性
- 性能影响
- 安全性考虑

---

**指南版本**: v3.0.6  
**适用对象**: 开发者和贡献者  
**维护状态**: 活跃维护

> 🎯 **目标**: 帮助开发者快速上手项目开发，建立高质量的代码贡献流程。