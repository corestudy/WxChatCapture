# 🔧 安装配置指南 v3.0.6

## 🎯 系统要求

### 📱 操作系统支持
- **Windows**: Windows 10/11 (推荐)
- **Python**: 3.7+ (推荐 3.8+ 以获得最佳性能)
- **内存**: 4GB+ RAM (推荐 8GB+ 用于大量截图)
- **存储**: 1GB+ 可用空间 (根据截图数量调整)

### 🔧 软件依赖
- **Python环境**: 必须安装Python 3.7或更高版本
- **pip包管理器**: 用于安装依赖包
- **Git**: 可选，用于获取最新代码

### 硬件要求
- **屏幕分辨率**: 1024x768+ (推荐 1920x1080+)
- **鼠标**: 支持滚轮的鼠标
- **键盘**: 标准键盘（Page键功能）

## 📦 安装步骤

### 方法一：标准安装（推荐）

#### 1. 安装Python
```bash
# 下载Python 3.8+
# 访问 https://python.org/downloads/
# 选择 "Add Python to PATH" 选项
```

#### 2. 获取项目
```bash
# 下载项目文件
# 解压到目标目录
cd smart-screenshot-tool/tk
```

#### 3. 安装依赖
```bash
# 安装所有依赖
pip install -r requirements.txt

# 验证安装
python -c "import cv2, tkinter, pyautogui; print('安装成功')"
```

#### 4. 运行程序
```bash
python src/main.py
```

### 方法二：虚拟环境安装

#### 1. 创建虚拟环境
```bash
# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows
venv\Scripts\activate
# Linux/Mac
source venv/bin/activate
```

#### 2. 安装依赖
```bash
# 升级pip
python -m pip install --upgrade pip

# 安装依赖
pip install -r requirements.txt
```

#### 3. 验证安装
```bash
python test_recording.py
```

## 📋 依赖详解

### 核心依赖
```
pillow>=9.0.0          # 图像处理
pyautogui>=0.9.54      # 屏幕操作
numpy>=1.21.0          # 数值计算
opencv-python>=4.5.0   # 视频录制
pywinauto>=0.6.8       # 窗口控制
keyboard>=0.13.5       # 键盘事件
```

### 可选依赖
```
psutil>=5.8.0          # 系统监控
hashlib2>=1.0.1        # 哈希计算（证据功能）
```

### 依赖安装问题解决

#### OpenCV安装失败
```bash
# 方法1：使用预编译版本
pip install opencv-python-headless

# 方法2：使用conda
conda install opencv

# 方法3：使用国内镜像
pip install opencv-python -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

#### tkinter缺失（Linux）
```bash
# Ubuntu/Debian
sudo apt-get install python3-tk

# CentOS/RHEL
sudo yum install tkinter
```

## ⚙️ 配置选项

### 基本配置

#### 1. 创建配置文件
程序首次运行会自动创建 `config.json`：
```json
{
  "screenshot": {
    "format": "PNG",
    "quality": 95,
    "optimize": false
  },
  "scroll": {
    "page_wait_time": 0.5,
    "mouse_wait_time": 0.3,
    "stability_wait": 0.8
  },
  "ui": {
    "theme": "modern",
    "window_size": "800x600",
    "auto_save": true
  }
}
```

#### 2. 修改配置
```python
# 通过程序界面修改
# 或直接编辑 config.json 文件
```

### 高级配置

#### 性能优化配置
```json
{
  "performance": {
    "memory_optimization": true,
    "cpu_priority": "normal",
    "max_threads": 4
  },
  "recording": {
    "default_fps": 10,
    "max_fps": 30,
    "codec": "mp4v"
  }
}
```

#### 证据功能配置
```json
{
  "evidence": {
    "enable_hash": true,
    "enable_timestamp": true,
    "enable_system_info": true,
    "case_id_format": "CASE_%Y%m%d_%H%M%S"
  }
}
```

## 🔐 权限设置

### Windows权限

#### 1. 屏幕访问权限
```
设置 → 隐私 → 屏幕录制
添加 Python.exe 到允许列表
```

#### 2. 文件访问权限
```
确保保存目录有写入权限
避免保存到系统保护目录
```

#### 3. 防火墙设置
```
Windows Defender → 允许应用通过防火墙
添加 Python 到例外列表
```

### 管理员权限
某些功能可能需要管理员权限：
```bash
# 以管理员身份运行命令提示符
# 然后运行程序
python src/main.py
```

## 📁 目录结构配置

### 推荐目录结构
```
智能截图工具/
├── tk/                    # 程序目录
│   ├── src/              # 源代码
│   ├── docs_unified/     # 统一文档
│   └── config.json       # 配置文件
├── 截图保存/              # 截图保存目录
│   ├── 微信聊天记录/
│   ├── 录制视频/
│   └── 证据记录/
└── 备份/                 # 备份目录
```

### 自定义保存路径
```python
# 在程序中设置
保存路径 → 浏览 → 选择目录

# 或修改配置文件
"save_path": "D:/Screenshots"
```

## 🔧 环境变量配置

### 可选环境变量
```bash
# Windows
set SCREENSHOT_TOOL_CONFIG=D:\config\screenshot.json
set SCREENSHOT_TOOL_DATA=D:\data\screenshots

# Linux/Mac
export SCREENSHOT_TOOL_CONFIG=/home/user/config/screenshot.json
export SCREENSHOT_TOOL_DATA=/home/user/data/screenshots
```

## 🚀 性能优化配置

### 系统优化
```
1. 关闭不必要的后台程序
2. 确保有足够的可用内存
3. 使用SSD存储提升文件写入速度
4. 调整Windows视觉效果为"最佳性能"
```

### 程序优化
```json
{
  "optimization": {
    "image_compression": true,
    "memory_cleanup": true,
    "thread_pool_size": 2,
    "cache_size": 100
  }
}
```

## 🔍 安装验证

### 功能测试脚本
```bash
# 运行完整测试
python test_main_fixed.py

# 测试截图功能
python -c "
import src.main as main
import tkinter as tk
root = tk.Tk()
app = main.ScrollScreenshotApp(root)
print('截图功能正常')
root.destroy()
"

# 测试录制功能
python -c "
import cv2
print(f'OpenCV版本: {cv2.__version__}')
writer = cv2.VideoWriter('test.mp4', cv2.VideoWriter_fourcc(*'mp4v'), 10, (800, 600))
print('录制功能正常' if writer.isOpened() else '录制功能异常')
writer.release()
"
```

### 性能基准测试
```bash
# 运行性能测试
python tests/test_performance.py

# 检查系统资源
python -c "
import psutil
print(f'CPU: {psutil.cpu_percent()}%')
print(f'内存: {psutil.virtual_memory().percent}%')
print(f'磁盘: {psutil.disk_usage('/').percent}%')
"
```

## 🛠️ 故障排除

### 常见安装问题

#### 1. pip安装失败
```bash
# 升级pip
python -m pip install --upgrade pip

# 使用国内镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/

# 清除缓存
pip cache purge
```

#### 2. 权限错误
```bash
# Windows: 以管理员身份运行
# Linux: 使用sudo（不推荐）或调整权限
chmod +x src/main.py
```

#### 3. 依赖冲突
```bash
# 创建新的虚拟环境
python -m venv fresh_env
fresh_env\Scripts\activate
pip install -r requirements.txt
```

### 配置问题

#### 1. 配置文件损坏
```bash
# 删除配置文件，程序会重新创建
rm config.json
python src/main.py
```

#### 2. 路径问题
```bash
# 确保使用绝对路径
# 避免包含特殊字符的路径
# 确保路径存在且有权限
```

## 📋 部署检查清单

### 安装前检查
- [ ] Python 3.7+ 已安装
- [ ] pip 已更新到最新版本
- [ ] 有足够的磁盘空间（1GB+）
- [ ] 网络连接正常（用于下载依赖）

### 安装后检查
- [ ] 所有依赖包安装成功
- [ ] 程序可以正常启动
- [ ] 界面显示正常
- [ ] 基本功能可用

### 功能检查
- [ ] 区域选择功能正常
- [ ] 截图功能正常
- [ ] 录制功能正常
- [ ] 文件保存正常
- [ ] 配置保存正常

## 📞 技术支持

### 安装支持
如果遇到安装问题，请提供：
1. 操作系统版本
2. Python版本
3. 错误信息完整截图
4. 安装步骤和命令

### 配置支持
如果遇到配置问题，请提供：
1. 配置文件内容
2. 具体的配置需求
3. 期望的功能效果
4. 当前的问题现象

---

**指南版本**: v3.0.6  
**适用对象**: 所有用户  
**更新频率**: 随版本更新  
**下一步**: [功能使用指南](03_功能使用指南.md)

> 🎯 **目标**: 确保您能够顺利安装和配置程序，为后续使用打下坚实基础。